parameters:
  - name: version
    type: string

steps:
- task: DotNetCoreCLI@2
  inputs:
    command: 'build'
    projects: '$(Build.SourcesDirectory)/NOP-${{ parameters.version }}/**/*.sln'
    arguments: '--configuration $(buildConfiguration)'
  displayName: 'dotnet build $(buildConfiguration) - NOP ${{ parameters.version }}'

- task: DotNetCoreCLI@2
  inputs:
   command: test
   projects: '$(Build.SourcesDirectory)/NOP-${{ parameters.version }}/**/CustomPlugins/**/*.Tests.csproj'
  displayName: 'dotnet test - NOP ${{ parameters.version }}'

- powershell: |
    If (!(Test-Path '$(Build.ArtifactStagingDirectory)/${{ parameters.version }}/Admin.ScheduleTaskLog')) {
        New-Item -Path '$(Build.ArtifactStagingDirectory)/${{ parameters.version }}/Admin.ScheduleTaskLog' -ItemType Directory
    }
  displayName: 'Check and create directory - ${{ parameters.version }}'

- powershell: |
    Copy-Item -Path '$(Build.SourcesDirectory)\NOP-${{ parameters.version }}\Presentation\Nop.Web\Plugins\Admin.ScheduleTaskLog\*' -Destination '$(Build.ArtifactStagingDirectory)\${{ parameters.version }}\Admin.ScheduleTaskLog' -Recurse
  displayName: 'Copy plugin - ${{ parameters.version }}'

- powershell: Remove-Item -Recurse -Force $(Build.SourcesDirectory)\NOP-${{ parameters.version }}
  displayName: 'Clean up NOP-${{ parameters.version }}'
